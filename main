<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Game</title>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        #map { height: 500px; width: 100%; margin-top: 10px; }
        #image-container { margin: 20px; }
        #score { font-size: 18px; margin-top: 10px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div id="password-screen">
        <h2>Entrez le mot de passe</h2>
        <input type="password" id="password-input" />
        <button onclick="checkPassword()">Valider</button>
        <p id="error-message" style="color: red;"></p>
    </div>
    
    <div id="game-screen" class="hidden">
        <h1>Location Game</h1>
        <p>Trouvez l'emplacement des photos sur la carte !</p>
        <div id="image-container">
            <img id="game-image" src="" alt="Game Image" width="300">
        </div>
        <div id="map"></div>
        <button onclick="validateGuess()">Valider</button>
        <p id="score">Score Actuel: 0 | Score Total: 0</p>
        <p id="message"></p>
    </div>
    
    <script>
        const password = "Qui veut du cake";
        function checkPassword() {
            let userInput = document.getElementById("password-input").value;
            if (userInput !== password) {
                document.getElementById("error-message").innerText = "Mot de passe incorrect !";
            } else {
                document.getElementById("password-screen").classList.add("hidden");
                document.getElementById("game-screen").classList.remove("hidden");
                initGame();
            }
        }

        function initGame() {
            let currentImage = "";
            let correctLat = 0;
            let correctLng = 0;
            let totalScore = 0;
            let map = L.map('map').setView([20, 0], 2);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            let marker;
            map.on('click', function(e) {
                if (marker) map.removeLayer(marker);
                marker = L.marker([e.latlng.lat, e.latlng.lng]).addTo(map);
            });
            
            function loadRandomImage() {
                let images = ["image1.jpg//48.858844,2.294351", "image2.jpg//40.748817,-73.985428"];
                currentImage = images[Math.floor(Math.random() * images.length)];
                document.getElementById("game-image").src = currentImage.split("//")[0];
                let coordsPart = currentImage.split("//")[1];
                if (coordsPart) {
                    let coords = coordsPart.split(",");
                    correctLat = parseFloat(coords[0]);
                    correctLng = parseFloat(coords[1]);
                } else {
                    correctLat = 0;
                    correctLng = 0;
                }
            }
            
            function validateGuess() {
                if (!marker) { alert("Veuillez sélectionner un emplacement sur la carte."); return; }
                let userLat = marker.getLatLng().lat;
                let userLng = marker.getLatLng().lng;
                let distance = getDistance(userLat, userLng, correctLat, correctLng);
                let score = calculateScore(distance);
                totalScore += score;
                document.getElementById("score").innerText = `Score Actuel: ${score} | Score Total: ${totalScore}`;
                document.getElementById("message").innerText = getEncouragement(score);
                
                let redIcon = L.icon({
                    iconUrl: 'https://upload.wikimedia.org/wikipedia/commons/e/e4/RedDot.svg',
                    iconSize: [20, 20]
                });
                L.marker([correctLat, correctLng], {icon: redIcon}).addTo(map);
                
                setTimeout(loadRandomImage, 2000);
            }
            
            function getDistance(lat1, lon1, lat2, lon2) {
                let R = 6371;
                let dLat = (lat2 - lat1) * Math.PI / 180;
                let dLon = (lon2 - lon1) * Math.PI / 180;
                let a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
                let c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                return R * c;
            }
            
            function calculateScore(distance) {
                if (distance < 0.001) return 200;
                if (distance < 1) return 180;
                if (distance < 5) return 150;
                if (distance < 20) return 100;
                if (distance < 50) return 50;
                return 0;
            }
            
            function getEncouragement(score) {
                if (score === 200) return "Incroyable, vous êtes un maître du repérage !";
                if (score >= 150) return "Très bien joué ! Continuez ainsi.";
                if (score >= 100) return "Pas mal, mais vous pouvez faire mieux !";
                return "Il faut s'améliorer ! Essayez encore.";
            }
            
            loadRandomImage();
        }
    </script>
</body>
</html>
